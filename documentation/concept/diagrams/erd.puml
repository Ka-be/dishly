@startuml
title Dishly - Entity Relationship Diagram

' Entities
entity "profiles" {
    * id : uuid <<PK>>
    --
    * user_id : uuid <<FK>> (auth.users)
    * firstname : varchar
    * lastname : varchar
    avatar_url : text
    * role_id : uuid <<FK>>
    * created_at : timestamp
    * updated_at : timestamp
}

entity "roles" {
    * id : uuid <<PK>>
    --
    * name : varchar (user|admin)
    * created_at : timestamp
}

entity "recipes" {
    * id : uuid <<PK>>
    --
    * title : varchar
    description : text
    image_url : text
    * servings : integer
    prep_time : integer
    cook_time : integer
    * is_public : boolean
    * user_id : uuid <<FK>>
    * created_at : timestamp
    * updated_at : timestamp
}

entity "ingredients" {
    * id : uuid <<PK>>
    --
    * name : varchar
    * created_at : timestamp
}

entity "recipe_ingredients" {
    * id : uuid <<PK>>
    --
    * recipe_id : uuid <<FK>>
    * ingredient_id : uuid <<FK>>
    * quantity : decimal
    * unit_id : uuid <<FK>>
}

entity "units" {
    * id : uuid <<PK>>
    --
    * name : varchar
    abbreviation : varchar
}

entity "tags" {
    * id : uuid <<PK>>
    --
    * name : varchar
    * created_at : timestamp
}

entity "categories" {
    * id : uuid <<PK>>
    --
    * name : varchar
    * created_at : timestamp
}

entity "steps" {
    * id : uuid <<PK>>
    --
    * recipe_id : uuid <<FK>>
    * order : integer
    * description : text
    image_url : text
    timer : integer
    * created_at : timestamp
}

entity "recipe_tags" {
    * recipe_id : uuid <<FK>>
    * tag_id : uuid <<FK>>
    --
    <<composite PK>>
}

entity "recipe_categories" {
    * recipe_id : uuid <<FK>>
    * category_id : uuid <<FK>>
    --
    <<composite PK>>
}

entity "user_favorites" {
    * id : uuid <<PK>>
    --
    * user_id : uuid <<FK>>
    * recipe_id : uuid <<FK>>
    * created_at : timestamp
}

' Relations
profiles }o--|| roles : "has"
profiles ||--o{ recipes : "owns"
profiles ||--o{ user_favorites : "has"

recipes ||--o{ recipe_ingredients : "contains"
recipes ||--o{ steps : "has"
recipes }o--o{ recipe_tags : "tagged with"
recipes }o--o{ recipe_categories : "belongs to"
recipes ||--o{ user_favorites : "favorited by"

recipe_ingredients }o--|| ingredients : "uses"
recipe_ingredients }o--|| units : "measured in"

recipe_tags }o--|| tags : "links"
recipe_categories }o--|| categories : "links"
@enduml